# Код-ревью проекта Currency Exchange API
- [GitHub](https://github.com/dmitrykitty/currency-exchange)

## Соблюдение разделения на слои

### Controller
- **Плюсы**: Четкое разделение на сервлеты по ресурсам (/api/currencies, /api/exchangeRates и т.д.). Каждый сервлет отвечает только за один ресурс. Используется DI через AppContext, что обеспечивает слабую связанность.

### Service
- **Плюсы**: Сервисы содержат бизнес-логику (маппинг исключений, расчет конверсии). Четкое разделение: CurrencyService, ExchangeRateService, ExchangeService.

### Repository
- **Плюсы**: DAO реализуют generic интерфейс Dao<K, E>, используют RowMapper для маппинга. Поддержка транзакций в update. Обработка специфических исключений SQLite.
- *На подумать*: обновить курс валют можно атомарно, используя 1 sql запрос. Но это задача со звездочкой в данном случае.

### Domain слой
- **Плюсы**: Entities как records с @Builder, VO для CurrencyPair. Четкое разделение на Entity и VO.

## Качество реализации REST

- **Эндпоинты и методы**:
    - GET /api/currencies — список валют (200)
    - POST /api/currencies — создание валюты (201)
    - GET /api/currency/{code} — валюта по коду (200)
    - GET /api/exchangeRates — список курсов (200)
    - POST /api/exchangeRates — создание курса (201)
    - GET /api/exchangeRate/{base}{target} — курс по паре (200)
    - PATCH /api/exchangeRate/{base}{target} — обновление курса (200)
    - GET /api/exchange?from=...&to=...&amount=... — конверсия (200)
- **Коды ответов**: Корректно используются 200, 201, 400, 404, 409, 500
- **Формат**: JSON через Jackson, параметры через query/form.

## Обработка ошибок и валидация

- **Обработка ошибок**: ExceptionFilter перехватывает исключения и маппит в HTTP коды. Кастомные исключения в каждом слое (DatabaseException, ServiceUnavailableException и т.д.).
- **Валидация**: HttpValidator валидирует входные данные (коды валют, имена, суммы). Используется regex для проверки форматов.

## Структура проекта и код-стайл

- **Структура**: Мульти-модульный Maven с четким разделением. Используются миграции, что хорошо. Код хорошо документирован (никогда не видел столько документации в реальных проектах, а было бы круто).
- **Код-стайл**: Консистентный, Lombok для boilerplate, SQL константы вынесены. Имена переменных и методов понятные.

## Минусы ключевых классов

### CurrencyDao
- handleSaveException — специфичная логика, я бы вынес в отдельный класс, но это вкусовщина.

### ExchangeRateDao
- update метод использует сложный SQL с подзапросом, что может быть неэффективно. Можно подумать о более производительном запросе.

### CurrencyService
- getCurrencies возвращает List<CurrencyDto>, но если список пустой, лучше вернуть пустой список, а не исключение.

### ExchangeService
- findExchangeRate — логика поиска курса смешана с расчетом, лучше разделить.

### CurrenciesServlet
- doPost не проверяет, что id=0 или пустое (хотя это DTO).

### HttpValidator
- validateName использует regex без учета unicode символов (только ASCII).

### ExceptionFilter
- Default case возвращает 500 без логирования ошибки.

## Заключение по архитектуре

### Что хорошо
- Четкое разделение слоев и ответственности.
- Правильное использование паттернов (DAO, DTO, Mapper).
- Глубокое понимание JDBC и low-level разработки.
- Хорошая обработка транзакций и исключений.
- Документация и README с диаграммами.

### Минусы
- Есть ошибки с валидацией и кросс-курсом. Но без тестов выявить это трудно, поэтому не переживай. Идеально не будет. В следующем проекте удели внимания юнит и интеграционным тестам и все будет ок.

Архитектура демонстрирует понимание принципов. Это одна из лучших и понятных реализаций этого проекта, что я видел. Такой код приятно читать! Если это написано самостоятельно, то точно стоит продолжать.
